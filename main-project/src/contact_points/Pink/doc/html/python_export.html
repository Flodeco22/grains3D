<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pink: Exporting functions to Python</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Pink<span id="projectnumber">&#160;0.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,true,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Exporting functions to Python</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p>The Pink library has two front-ends; the Bash and the Python front-end. Historically almost all of the operators are already exported into the Bash front-end. For an undetermined transition period, both front-ends should be maintained. That means, that new functions should appear in Bash and Python as well.</p>
<p>Note that all the conventions are respected as the complete Python wrapper, including the wrapping macros, is written in C++. For further reading we suggest !!!!</p>
<h1><a class="anchor" id="bash"></a>
Bash front-end</h1>
<p>To export the functions in Bash, you have to create a file named 'my_function.c' in the 'src/com' directory. The file should contain a main function, which parses it's parameters and calles <b>exactly one</b> appropriate Pink operator. The format of the command line parameters is the following:</p>
<pre class="fragment">operator_name input_image.pgm t1 t2 t3 output_image.pgm
</pre><p>The main function should look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// tests on the number of parameters</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// reading of the input image</span></div>
<div class="line">  result = <a class="code hl_function" href="mcimage_8h.html#ab939ad2ff760a9df20d3f39dfad0c184">readimage</a>(argv[1])</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// conversion (but NOT testing!) of the input parameters</span></div>
<div class="line">  T1 t1 = convert_or_read(argv[2])</div>
<div class="line">  T2 t2 = convert_or_read(argv[3])</div>
<div class="line">  ...</div>
<div class="line">  Tn tn = convert_or_read(argv[n])</div>
<div class="line"> </div>
<div class="line">  pink_c_function(result, t1, t2, ..., tn);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// &quot;returning&quot; the result</span></div>
<div class="line">  <a class="code hl_function" href="mcimage_8h.html#a469569831948431a0e78f302bfa5207c">writeimage</a>(result, argv[n+1]);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="amcimage_8h_html_a469569831948431a0e78f302bfa5207c"><div class="ttname"><a href="mcimage_8h.html#a469569831948431a0e78f302bfa5207c">writeimage</a></div><div class="ttdeci">void writeimage(struct xvimage *image, char *filename)</div><div class="ttdoc">Writes an image to disk.</div></div>
<div class="ttc" id="amcimage_8h_html_ab939ad2ff760a9df20d3f39dfad0c184"><div class="ttname"><a href="mcimage_8h.html#ab939ad2ff760a9df20d3f39dfad0c184">readimage</a></div><div class="ttdeci">struct xvimage * readimage(const char *filename)</div><div class="ttdoc">Reads an image from a file.</div></div>
</div><!-- fragment --><p>The tests for the content of the parameters should be carried out in 'pink_c_function' as specified in the <a class="el" href="dev_conventions.html">Conventions for developing Pink operators</a>. The created files are automatically detected and compiled by CMake.</p>
<p>Note: Do not forget to add the created files to the svn repository.</p>
<h1><a class="anchor" id="python"></a>
Python front-end</h1>
<p>There are several wrapper functions to facilitate the export of Pink functions to Python.</p>
<h1><a class="anchor" id="doc_export"></a>
Documentation export</h1>
<p>When you are wrapping functions in Python, the wrapper functions allow you to write your documentation directly at wrapping. This is however not the suggested way of documenting functions in python. After each compilation a python script extracts the doxygen documentation of the operators in the file include/python_doc.h. Each file 'src/com/operator.c' has a macro defined in 'python_doc.h' called 'doc__operator__c__'. You should use these macros, where exporting documentation in Python.</p>
<h1><a class="anchor" id="c_functions"></a>
C functions</h1>
<p>There are three wrappers for exporting functions in python. The macros have to be called in 'src/python/pypink.cpp'. The function types are as defined in <a class="el" href="dev_conventions.html">Conventions for developing Pink operators</a>.</p>
<ul>
<li>
<p class="startli"><b>Standard functions</b></p>
<div class="fragment"><div class="line">UI_WRAP_FUNCTION(</div>
<div class="line">  <span class="stringliteral">&quot;function_name_in_python&quot;</span>,</div>
<div class="line">  function_name,</div>
<div class="line">  (arg(<span class="stringliteral">&quot;T1&quot;</span>), arg(<span class="stringliteral">&quot;T2&quot;</span>), ..., arg(<span class="stringliteral">&quot;Tn&quot;</span>)),</div>
<div class="line">  <span class="stringliteral">&quot;documentation string&quot;</span> <span class="comment">// or doc__function_name__c__</span></div>
<div class="line">);</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli"><b>Result functions</b></p>
<div class="fragment"><div class="line">UI_WRAP_RESULT(</div>
<div class="line">  result_type,</div>
<div class="line">  <span class="stringliteral">&quot;function_name_in_python&quot;</span>,</div>
<div class="line">  function_name,</div>
<div class="line">  (arg(<span class="stringliteral">&quot;T1&quot;</span>), arg(<span class="stringliteral">&quot;T2&quot;</span>), ..., arg(<span class="stringliteral">&quot;Tn&quot;</span>)),</div>
<div class="line">  doc__function_name__c__</div>
<div class="line">);</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli"><b>Value functions</b></p>
<div class="fragment"><div class="line">UI_WRAP_VALUE(</div>
<div class="line">  <span class="stringliteral">&quot;function_name_in_python&quot;</span>,</div>
<div class="line">  function_name,</div>
<div class="line">  (arg(<span class="stringliteral">&quot;T1&quot;</span>), arg(<span class="stringliteral">&quot;T2&quot;</span>), ..., arg(<span class="stringliteral">&quot;Tn&quot;</span>)),</div>
<div class="line">  doc__function_name__c__</div>
<div class="line">);</div>
</div><!-- fragment --> </li>
</ul>
<p>After including the appropriate macro call in 'pypink.cpp' the functions appear in Python. Examples can be found in 'pypinp.cpp'.</p>
<h1><a class="anchor" id="cpp_export"></a>
C++ functions.</h1>
<p>C++ functions are exported with the boost export function 'def'. The parametrisation remains the same as for the WRAP macros:</p>
<div class="fragment"><div class="line">def(</div>
<div class="line">  <span class="stringliteral">&quot;function_name_in_python&quot;</span>,</div>
<div class="line">  function_name,</div>
<div class="line">  (arg(<span class="stringliteral">&quot;T1&quot;</span>), arg(<span class="stringliteral">&quot;T2&quot;</span>), ..., arg(<span class="stringliteral">&quot;Tn&quot;</span>)),</div>
<div class="line">  doc__function_name__cpp__</div>
<div class="line">);</div>
</div><!-- fragment --><dl class="section author"><dt>Author</dt><dd>ujoimro, 2011 </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
